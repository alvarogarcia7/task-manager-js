<html>

<body>

<div>


<input type="button" id="removedAll" name="removedAll" value="clear tasks" onclick="viewModel.removeAll()";/>
<!-- <input type="button" onclick="localStorage.clear();;" value="Clear all localStorage"/> -->
<input type="button" onclick="javascript:console.log(viewModel.tasks());" value="View tasks in console.log"/>
<input type="button" onclick="javascript:viewModel.retrieveFromServer();" value="Retrieve from server"/>
<input type="button" onclick="javascript:viewModel.saveToServer();" value="Save to server"/>



<script type="text/javascript" src="../../../lib/knockoutjs/knockout-3.0.0.debug.js"></script>
<script type="text/javascript" src="../../../lib/cufon-yui.js"></script>
<script type="text/javascript" src="../../../lib/titilliummaps.font.js"></script>
<script type="text/javascript" src="../../../lib/knockoutjs/json2.js"></script>

<script type="text/javascript" src="../../../lib/knockoutjs/switch-case/knockout-switch-case.js"></script>

<script src="../../../lib/jquery-2.0.3/jquery-2.0.3.min.js"></script>
<script src="../../../lib/jquery-2.0.3/jquery.json-2.4.js"></script>
<script src="../../../lib/modernizr/modernizr.js"></script>
<script src="../js/common-functions.js"></script>
<script src="../js/App.js"></script>
<!-- <link href="http://www.jsviews.com/samples/samples.css" rel="stylesheet"/> -->
<link href="../styles/tango32.css" rel="stylesheet"/>




<div class='liveExample'> 

	<div>
	<!-- ko switch -->
		<div data-bind="case.visible: !$root.newTask()">
			<a class="action newTask" id="addNewTaskButton" data-bind='click: $root.createNewTask' title="Add new task"></a>
		</div>

		<div data-bind="case.visible: $else">
			<input type="text" id="taskName"
				 data-bind="value: $root.currentItem().name, valueUpdate:'afterkeydown'"
				 onchange="console.log('changed name. now = '+$(this).val());"
				 value="tarea dificil" class="new" />
			<input type="text" id="taskDate"
				data-bind="value: $root.currentItem().deadline, valueUpdate:'afterkeydown'"
				value="el aÃ±o que viene"  class="new" />
			<a class="action commitNewTask" id="addButton" data-bind='click: $root.add' title="Add task"></a>
			<a class="action rollbackNewTask" data-bind='click: $root.rollbackTask' title="Cancel"></a>
		</div>
	<!-- /ko -->
	</div>

	
    
    <form >
        <p>You have asked for <span data-bind='text: tasks().length'>&nbsp;</span> task(s)</p>
        
        <table >
            <thead>
                <tr>
					<th>ID</th>
                    <th>task name</th>
                    <th>deadline</th>
                    <th />
                </tr>
            </thead>
            <tbody data-bind='foreach: tasks'>

            	<tr >
            		<td style="display:block"><span data-bind='text: id'></span></td>

            	<!-- ko switch -->

				    <!-- ko case: $parent.currentItem()  && $data.id == $parent.currentItem().id  -->
					    <td><input class='inlined required' data-bind='value: name' /></td>
	                    <td><input class='inlined required number' data-bind='value: deadline' /></td>

						<td><a id="rollbackTask" class="action rollbackEditTask" href='#' data-bind='click: $root.rollbackTask' title="Discard changes"></a></td>
	                    <td><a id="commitTask"   class="action commitEditTask"   href='#' data-bind='click:$root.commitTask;' title="Save changes"></a></td>
				    <!-- /ko --> <!-- ko case: $else -->
	                    <td ><span class='required ' data-bind='text: name' /></span></td>
	                    <td ><span class='required number ' data-bind='text: deadline' /></span>
	                    </td>
	                    <td><a class="action editTask" href='#' data-bind='click: $root.editTask' title="Edit task"></a></td>
	                    <td><a class="action deleteTask" href='#' data-bind='click: function(data,event){ $parent.removeTask(data,true); };' title="Delete task"></a></td>
                    <!-- /ko -->
            	<!-- /ko -->

				<!-- $data is the current element:
				http://knockoutjs.com/documentation/foreach-binding.html see note 1 -->
                </tr>
            </tbody>
        </table>
     
        
        <!-- <button  data-bind='enable: tasks().length > 0' type='submit'>Submit</button> -->
    </form>
    <pre><span data-bind='text: $.toJSON(tasks(), null, 2)'>&nbsp;</span></pre>
    
</div>

<script type="text/javascript">

$(document).ready(function(){


 viewModel = new App();
 //viewModel.addDummyData();
 viewModel.retrieveFromStorage();
 ko.applyBindings(viewModel);

 $('input.new').on('keypress',function(event){
 	if(isEnter(event,true)){
		$('#addButton')[0].click();
	}
  });

 $('input.inlined').on('keypress',function(event){
 	if(isEnter(event,true)){
		$('#commitTask').click();
	}
  });
});

</script>


<script>
var viewModel;
</script>
</body>
</html>

