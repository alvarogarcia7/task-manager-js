<html>

<body>

<div>


<input type="button" id="removedAll" name="removedAll" value="clear tasks" onclick="viewModel.removeAll()";/>
<!-- <input type="button" onclick="localStorage.clear();;" value="Clear all localStorage"/> -->
<input type="button" onclick="javascript:console.log(viewModel.tasks());" value="View tasks in console.log"/>



<script type="text/javascript" src="../../../lib/knockoutjs/knockout-3.0.0.debug.js"></script>
<script type="text/javascript" src="http://knockoutjs.com/js/cufon-yui.js"></script>
<script type="text/javascript" src="http://knockoutjs.com/js/titilliummaps.font.js"></script>
<script type="text/javascript" src="http://knockoutjs.com/js/json2.js"></script>

<script type="text/javascript" src="http://knockoutjs.com/js/syntaxhighlighter_3.0.83/scripts/shCore.js"></script> 
<script type="text/javascript" src="http://knockoutjs.com/js/syntaxhighlighter_3.0.83/scripts/shBrushJScript.js"></script> 
<script type="text/javascript" src="http://knockoutjs.com/js/syntaxhighlighter_3.0.83/scripts/shBrushXml.js"></script> 

<script type="text/javascript" src="../../../lib/knockoutjs/switch-case/knockout-switch-case.js"></script>

<script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
<script src="https://jquery-json.googlecode.com/files/jquery.json-2.4.js"></script>
<script src="../../../lib/modernizr/modernizr.js"></script>
<script src="../js/common-functions.js"></script>
<script src="../js/App.js"></script>




<img class="remove" src="http://www.jsviews.com/resources/images/close.png" />
<div class='liveExample'> 

	<!-- ko if: $root.cache() == null -->
	<button id="addNewTaskButton" data-bind='click: $root.createNewTask'> Add new task</button>
     <!-- /ko -->

	<!-- ko if: $root.cache() !=null && $root.currentItem() !=null-->
		<input type="text" id="taskName" data-bind="value: currentItem().name, valueUpdate:'afterkeydown'" onchange="console.log('changed name. now = '+$(this).val());" value="tarea dificil" onkeypress="conditionalAddTask(event);"/>
		<input type="text" id="taskDate" data-bind="value: currentItem().deadline, valueUpdate:'afterkeydown'" value="el aÃ±o que viene"  onkeypress="conditionalAddTask(event)"/>
	<!-- /ko -->
	
    
    <form >
        <p>You have asked for <span data-bind='text: tasks().length'>&nbsp;</span> task(s)</p>
        
        <table >
            <thead>
                <tr>
					<th>ID</th>
                    <th>task name</th>
                    <th>deadline</th>
                    <th />
                </tr>
            </thead>
            <tbody data-bind='foreach: tasks'>

            	<tr >
            		<td style="display:block"><span data-bind='text: id'></span></td>
            	<!-- ko switch -->
				    <!-- ko case: $parent.currentItem()  && $data.id == $parent.currentItem().id  -->
					    <td><input class='required' data-bind='value: name' /></td>
	                    <td><input class='required number' data-bind='value: deadline' /></td>

	                    <td><a  href='#' data-bind='click:$root.commitTask;'>Accept/Commit</a></td>
						<td><a  href='#' data-bind='click: $root.rollbackTask'>Not Accept/Rollback</a></td>
				    <!-- /ko --> <!-- ko case: $else -->
	                    <td ><span class='required ' data-bind='text: name' />&nbsp;</span></td>
	                    <td ><span class='required number ' data-bind='text: deadline' /></span></td>
						<td><a class="editTask" href='#' data-bind='click: $root.editTask'>Edit</a></td>
						<td><a class="deleteTask" href='#' data-bind='click: function(data,event){ $parent.removeTask(data,true); };'>Delete</a></td>

                    <!-- /ko -->
            	<!-- /ko -->

				<!-- $data is the current element:
				http://knockoutjs.com/documentation/foreach-binding.html see note 1 -->
                </tr>
            </tbody>
        </table>
     
        <button id="addButton" data-bind='click: function(data,event){
        		var currentItem = data.currentItem();
        		console.log(currentItem);
        	  add(currentItem);
        	};'>
        	 Add task</button>
        <!-- <button  data-bind='enable: tasks().length > 0' type='submit'>Submit</button> -->
    </form>
    <pre><span data-bind='text: $.toJSON(tasks(), null, 2)'>&nbsp;</span></pre>
    
</div>

<script type="text/javascript">

function conditionalAddTask(e){
	if(isEnter(e,true)){
		$('#addButton').click();
	}
};

$(document).ready(function(){


 viewModel = new App();
 //viewModel.addDummyData();
 viewModel.retrieveFromStorage();
 ko.applyBindings(viewModel);
});

</script>


<script>
var viewModel;
$(document).ready(function(){

	$('#taskName').keypress(function(e){
		console.log("pasa taskName.keypress");
		if(isEnter(e,true)){

			$('#addButton').click();
		}
	});

	$('#taskDate').keypress(function(e){
		if(isEnter(e,true)){

			$('#addButton').click();
		}
	});

});

</script>
</body>
</html>

