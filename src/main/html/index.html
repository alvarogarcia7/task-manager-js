<html>

<head>

</head>

<body>

<div>

<script>
var contentStd ={
 tasks:[],
 };
 </script>

<input type="text" id="taskName" onchange="console.log('a');" value="crear tarea"/>
<input type="text" id="taskDate" value="22/10" />

<input type="button" id="removedAll" name="removedAll" value="clear tasks"/>
<!-- <input type="button" onclick="sessionStorage.clear();;" value="Clear all sessionStorage"/> -->
<input type="button" onclick="javascript:console.log(app.tasks);" value="View tasks in console.log"/>
</div>

<script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
<script src="https://jquery-json.googlecode.com/files/jquery.json-2.4.js"></script>
<script src="../../../lib/modernizr/modernizr.js"></script>
<script src="../js/common-functions.js"></script>
<script src="../js/App.js"></script>


<link href="http://www.jsviews.com/samples/samples.css" rel="stylesheet"/>
<script src="http://www.jsviews.com/download/jsviews.js"></script>

<script>
var app = new App();
app.retrieveFromStorage();


var content;
$(document).ready(function(){

function addNewTask(){
	$('#add').click();
}

$('#taskName').keypress(function(e){
	if(isEnter(e,true)){
		addNewTask();
	}
});
$('#taskDate').keypress(function(e){
	if(isEnter(e,true)){
		addNewTask();
	}
});


updateView();

function updateView(){
	$.templates("#taskTemplate").link("#result", app)
		.on("click", ".remove", function() {
			var view = $.view(this);
			console.log(app);
			console.log(view.index);
			$.observable(app.tasks).remove(view.index);
			app.persist();
		})
		  .on("click", "#add", function() {
		  	console.log(app.tasks);
		  	console.log($.observable(app.tasks));

			var task=new Object();
			task.name=$('#taskName').val();
			task.deadline=$('#taskDate').val();
			$.observable(app.tasks).insert(app.tasks.length, task);
			app.persist();
		  })
		.on("click", "#removeAll", function() {
			console.log($.observable(app.tasks));
			

			var initialLength=app.tasks.length;
			for(var i=0;i<initialLength;i++){
				$.observable(app.tasks).remove(0);
			}

			app.persist();

		  });
}
});
</script>

<div id="result"></div>

<script id="taskTemplate" type="text/x-jsrender">
<div>
  <div class="buttons">
  <button id="add">Add</button>
</div>
<ol>
  {^{for tasks}}
    <li>
      <img class="remove" src="http://www.jsviews.com/resources/images/close.png" /> {^{:name}} 
    </li>
  {{/for}}
</ol>
</div>

<button id="removeAll"> clear all</button>

</script>

</body>
</html>

