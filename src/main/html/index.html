<!DOCTYPE html>
<html lang="en">


<head>
<script type="text/javascript" src="../../../lib/knockoutjs/knockout-3.0.0.debug.js"></script>

<script type="text/javascript" src="../../../lib/cufon-yui.js"></script>
<script type="text/javascript" src="../../../lib/titilliummaps.font.js"></script>
<script type="text/javascript" src="../../../lib/knockoutjs/json2.js"></script>

<script type="text/javascript" src="../../../lib/knockoutjs/switch-case/knockout-switch-case.js"></script>

<link href="../../../lib/bootstrap-3.0.2/css/bootstrap.css" rel="stylesheet"/> 
<link href="../../../lib/bootstrap-3.0.2/css/bootstrap-theme.css" rel="stylesheet"/> 
<!-- https://raw.github.com/marcoceppi/bootstrap-glyphicons/master/css/bootstrap.icon-large.css -->
<link href="../../../lib/bootstrap-3.0.2/css/bootstrap.icon-large.css" rel="stylesheet"/> 

<script src="../../../lib/security/sha1-min.js"></script>


<script src="../../../lib/jquery-2.0.3/jquery-2.0.3.min.js"></script>
<script src="../../../lib/jquery-2.0.3/jquery.json-2.4.js"></script>
<script src="../../../lib/modernizr/modernizr.js"></script>
<script src="../js/common-functions.js"></script>
<script src="../js/App.js"></script>
<script type="text/javascript" src="../../../lib/bootstrap-3.0.2/js/bootstrap.js"></script>
<script type="text/javascript" src="../../../lib/knockoutjs/knockout-bootstrap.min.js"></script>
<!-- <link href="http://www.jsviews.com/samples/samples.css" rel="stylesheet"/> -->
<link href="../styles/tango32.css" rel="stylesheet"/>
<link href="../styles/test-bootstrap1.css" rel="stylesheet"/>
<link href="../styles/basic.css" rel="stylesheet"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
       <div class="container Override">
        <div class="row">
            <div class="col-md-12">
			
			
			<div name="actions" class="row-fluid">
	<button id="removedAll" name="removedAll" title="clear tasks" onclick="viewModel.removeAll();" class="btn">
		<i class="icon-large icon-cleaning"></i> Clear tasks 
	</button>
	<!-- <input type="button" onclick="localStorage.clear();;" value="Clear all localStorage"/> -->
	<button class="btn" type="button" onclick="javascript:console.log(viewModel.tasks());">
		<i class="icon-large icon-eye-open"></i> View tasks in console.log
	</button>
	<button class="btn" onclick="javascript:viewModel.retrieveFromServer();">
		<i class="icon-large icon-inbox-in"></i>Retrieve from server
	</button>
	<button class="btn" id="saveToServer" onclick="javascript:saveAll(true);">
		<i class="icon-large icon-inbox-out"></i>Save to server
	</button>



<!-- http://stackoverflow.com/questions/11268863/knockoutjs-unable-to-parse-bindings-in-plugin-using-ko-rendertemplate -->
	<span data-binding="text: passwd"></span>
	<button class="btn" data-bind="popover: {template: 'popoverBindingTemplate', title: 'Settings',placement:'bottom'/*, trigger:'focus' */}">
		<i class="icon-large icon-settings"></i>
	</button>
 
<script type="text/html" id="popoverBindingTemplate">
    <button class="close pull-right" type="button" data-dismiss="popover">X</button>
    <form>
        <label>Username</label>
        <input type="text" data-bind="value: username, valueUpdate:'afterkeydown'" />
        <label>Password</label>
        <input type="password" data-bind="value: passwd, valueUpdate:'afterkeydown', event: {change: $root.createToken} "/>
    </form>
</script>
			
			</div>
        </div>
        <div class="row-fluid" style="display:none;">
            <div class="col-md-12">header section</div>
        </div>
        <div class="row-fluid fill">
                <div class="col-md-3 float-left">
					<!-- ko switch -->
					<div data-bind="case.visible: !$root.newTask()" class="row-fluid">
						<button class="btn action newTask" id="addNewTaskButton" data-bind='click: $root.createNewTask' title="Add new task">
							<i class="icon-large icon-asterisk"></i>Add task
						</button>
					</div>

					<div data-bind="case.visible: $else" class="row">
						<!--<div class="row-fluid"> &nbsp; </div>-->
						<div class="row-fluid">
							<div class="col-md-12">
								<input type="text" id="taskName"
									 data-bind="value: $root.currentItem().name, valueUpdate:'afterkeydown'"
									 onchange="console.log('changed name. now = '+$(this).val());"
									 value="tarea dificil" class="new" />
								<input type="text" id="taskDate"
									data-bind="value: $root.currentItem().deadline, valueUpdate:'afterkeydown'"
									value="el aÃ±o que viene"  class="new" />
							</div>
						</div>	
						<div class="row-fluid">
							<div class="col-md-12">
								<!-- http://marcoceppi.github.io/bootstrap-glyphicons/ -->
								<button class="btn" id="addButton" data-bind='click: $root.add' title="Add task"><i class="icon-large icon-plus-sign"></i> Save</button>
								<button class="btn" data-bind='click: $root.rollbackTask' title="Cancel"><i class="action icon-large icon-remove-sign"></i>Cancel</button>
							</div>
						</div>
					</div>

					<div class="row-fluid">
						<p> project 1</p>
						<p> project 1</p>
						<p> project 1</p>
						<p> project 1</p>
						<p> project 1</p>
					</div>
		<!-- /ko -->
				</div>
		<div class="col-ld-9 col-md-8 float-left fluid">
           		  
        <div class="row-fluid">
        	You have <span data-bind='text: tasks().length'>&nbsp;</span> task(s)
        </div>
        
        <div class="row-fluid">
				<!-- ID -->
                 <div class="col-xs-12 col-md-4">Done - task name</div>
                 <div class="col-xs-12 col-md-8">deadline</div>
        </div>
        <div data-bind='foreach: tasks' class="container-fluid">
        	<div class="row-fluid">
        	<!-- ko switch -->
			    <!-- ko case:  isSameItem($parent.currentItem(),$data) -->
				    <div class="col-xs-12 col-md-4"><input class='inlined required' data-bind='value: name' size="35%" onkeypress="
							if(isEnter(event,true)){
					    		$('#commitTask')[0].click();
					    	}
				    	" /></div>
                    <div class="col-xs-12 col-md-2"><input class='inlined required number' data-bind='value: deadline'  size="10%" onkeypress="
							if(isEnter(event,true)){
					    		$('#commitTask')[0].click();
					    	}
				    	" /></div>
				    <div class="col-xs-12 col-md-2" data-bind="foreach: categories()">
				    	<input class='inlined' data-bind='value: $data'  size="10%"/>
				    </div>


					<div class="col-xs-12 col-md-4">
					  <button id="rollbackTask" class="action btn rollbackEditTask" href='#' data-bind='click: $root.rollbackTask' title="Discard changes" ><i class="icon-large icon-unshare"></i><!-- Discard changes --></button>
                      <button id="commitTask" class="action btn commitEditTask"   href='#' data-bind='click:$root.commitTask;' title="Save changes" ><i class="icon-large icon-ok-sign"></i><!-- Save changes --></button>
                    </div>
                <!-- /ko --> <!-- ko case: !isSameItem($parent.currentItem(),$data) && isDone($data,1) -->
                	<div class="col-xs-4 col-md-4 col-ld-4">
						<input type="checkbox" data-bind='checked: done' /></span>
						<span class='required ' data-bind='css: { taskDone: $data.done }, text: name' /></span>
						</div>
			    	<div class="col-xs-8 col-md-4 col-ld-8">
			    		<span class='required number ' data-bind=' css: { taskDone: $data.done } ,text: deadline' /></span>
			    	</div>
			    	<div class="col-xs-8 col-md-8 col-ld-8" > &nbsp; </div>

                <!-- /ko --> <!-- ko case: !isSameItem($parent.currentItem(),$data) && !isDone($data,2) -->
					<div class="col-xs-4 col-md-4" >
						<div class="row">
							<input type="checkbox" data-bind='checked: done' /></span>
							<span class='required ' data-bind='text: name' /></span>
							<span class='required ' data-bind='text: categories().length' /></span>
						</div> <div class="row">
							<div data-bind="foreach: categories">
								<span data-bind="text: $parent.getCategory($data)"></span>
							</div>
						</div>
						</div>
			    	<div class="col-xs-4 col-md-4" >
			    		<span class='required number ' data-bind='text: deadline' /></span>
			    	</div>
			    	<div class="col-xs-4 col-md-4" >
				    		<button class="btn editTask" href='#' data-bind='click: $root.editTask' title="Edit task"><i class="icon-large icon-pencil"></i><!--  Edit task --></button>
		                  	<button class="btn action deleteTask" href='#' data-bind='click: function(data,event){ $parent.removeTask(data,true); };' title="Delete task"><i class="icon-large  icon-trash"></i><!-- Remove task --></button>
					</div>
                <!-- /ko --> <!--ko case: $else -->
                <!-- /ko -->

        	<!-- /ko -->
        	</div>
     	</div>

     	

<!--      	<div class="row-fluid">
     	 <p>Content</p>
     	</div>
     	<div class="row-fluid">
     	 <p>Content</p>
     	</div>
 -->
     	</div>
		</div>
		</div>
		     </div>
	</div>
        	</div>
        <!-- <button  data-bind='enable: tasks().length > 0' type='submit'>Submit</button> -->

    <pre><span data-bind='text: ko.toJSON(tasks(), null, 2)'>&nbsp;</span></pre> 


    <!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Login to TodoTwist</h4>
      </div>
      <div class="modal-body">

	     <button class="close pull-right" type="button" data-dismiss="popover">X</button>
        <label>Username</label>
        <input type="text" data-bind="value: username, valueUpdate:'afterkeydown'" />
        <label>Password</label>
        <input type="password" data-bind="value: passwd, valueUpdate:'afterkeydown', event: {change: $root.createToken} "/>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Signup</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="viewModel.retrieveFromServer(false);">Login</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
    
</div>

<script type="text/javascript">

function isSameItem(currentItem,data){
	return currentItem  && data.id == currentItem.id;
}

function isDone(task,pasada){
	return task.done();
}

  function saveAll(alertIfError){
	viewModel.persist();
	return viewModel.saveToServer(alertIfError);
}


$(document).ready(function(){

// var tempVM = ko.observable(new App());

 viewModel = new App();
 //viewModel.addDummyData();
 ko.applyBindings(viewModel);
 $('#myModal').modal([]);
 
 // viewModel.retrieveFromStorage();

 
/*
function saveBeforeExit(){
	$('#saveToServer')[0].click();
}

$(window).unload( saveBeforeExit );
window.onbeforeunload = saveBeforeExit;
*/
$(window).bind('beforeunload', function(){
	var retValue = saveAll(false);

	if(viewModel.dirty()){
		//http://stackoverflow.com/questions/7080269/javascript-before-leaving-the-page
		return "Any changes made will be lost. Are you sure you want to leave?";
	}
  return retValue;
});




 $('input.new').on('keypress',function(event){
 	if(isEnter(event,true)){
		$('#addButton')[0].click();
	}
  });

 $('input.inlined').on('keypress',function(event){
 	if(isEnter(event,true)){
		$('#commitTask').click();
	}
  });
});

</script>


<script>
var viewModel;
</script>
</body>
</html>

